<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tặng TDi</title>
    <style>
        :root {
            --accent: #ff4d6d;
            --accent-2: #ff6b8a;
            --bg: radial-gradient(1200px 800px at 50% 40%, #fff 0%, #fbe9ef 45%, #ffd6e4 100%);
            --bar-h: 16px;
            --heart-size: 28px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: var(--bg);
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
            color: #c2185b;
            overflow: hidden;
        }

        /* ========= LOADER ========= */
        .loader {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            background: linear-gradient(180deg, #fff 0%, #ffe6eb 100%);
            z-index: 10;
            transition: opacity .6s ease, visibility .6s ease;
        }

        .loader-inner {
            width: min(92vw, 550px);
            display: flex;
            flex-direction: column;
            gap: 18px;
            align-items: stretch;
            padding: 28px 24px;
            border-radius: 20px;
            background: #ffffffcc;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .08), 0 2px 10px rgba(0, 0, 0, .05);
            backdrop-filter: blur(4px);
        }

        .title {
            font-weight: 700;
            font-size: clamp(18px, 2.5vw, 22px);
            color: #ff4d88;
            text-align: center;
            letter-spacing: .2px;
        }

        .progress-wrap {
            position: relative;
            width: 100%;
            height: calc(var(--bar-h) + 18px + var(--heart-size));
            padding-top: 6px;
            padding-left: calc(var(--heart-size) / 2);
            padding-right: calc(var(--heart-size) / 2);
        }

        .progress-track {
            position: absolute;
            left: calc(var(--heart-size) / 2);
            right: calc(var(--heart-size) / 2);
            top: calc(var(--heart-size) + 12px);
            height: var(--bar-h);
            background: #ffe0ea;
            border-radius: 999px;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, .06);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-2) 100%);
            border-radius: 999px;
            transition: width 120ms linear;
            box-shadow: 0 0 0 1px #ffffffaa inset;
        }

        .progress-heart {
            position: absolute;
            top: 0;
            left: calc(var(--heart-size) / 2);
            width: var(--heart-size);
            height: var(--heart-size);
            transform: translateX(-50%);
            transition: transform 120ms linear;
            filter: drop-shadow(0 6px 10px rgba(255, 77, 109, .35));
            color: #ff4d88;
            z-index: 2;
        }

        .progress-heart svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .percent {
            position: absolute;
            top: calc(var(--heart-size) + var(--bar-h) + 18px);
            left: 50%;
            transform: translateX(-50%);
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            color: #ff4d88;
            letter-spacing: .5px;
        }

        .loader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        /* ========= SCENE CHÍNH ========= */
        .scene {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            padding: 24px;
            opacity: 0;
            transform: translateY(8px);
            transition: opacity .6s ease .15s, transform .6s ease .15s;
        }

        .scene.show {
            opacity: 1;
            transform: translateY(0);
        }

        .wrap {
            position: relative;
            display: grid;
            place-items: center;
            gap: 24px;
            padding-inline: 20px;
        }

        .wrap::after {
            content: "";
            position: absolute;
            width: 350px;
            height: 350px;
            border-radius: 50%;
            filter: blur(40px);
            background: radial-gradient(circle, rgba(255, 77, 109, 0.4) 0%, rgba(255, 107, 138, 0.2) 50%, transparent 100%);
            z-index: 0;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {

            0%,
            100% {
                transform: scale(.9);
                opacity: .7;
            }

            50% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        /* ===== Trái tim 3D đẹp mới ===== */
        .heart-container {
            position: relative;
            width: clamp(250px, 65vw, 400px);
            height: clamp(220px, 60vw, 360px);
            z-index: 1;
            animation: heartFloat 3s ease-in-out infinite;
        }

        @keyframes heartFloat {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            25% {
                transform: translateY(-8px) rotate(1deg);
            }

            50% {
                transform: translateY(-4px) rotate(0deg);
            }

            75% {
                transform: translateY(-6px) rotate(-1deg);
            }
        }

        .heart-3d {
            width: 100%;
            height: 100%;
            display: block;
            filter: drop-shadow(0 20px 40px rgba(255, 77, 109, 0.3));
            animation: beat3d 1.2s ease-in-out infinite;
        }

        @keyframes beat3d {
            0% {
                transform: scale(1);
            }

            14% {
                transform: scale(1.1);
            }

            28% {
                transform: scale(1.05);
            }

            42% {
                transform: scale(1.15);
            }

            70% {
                transform: scale(1.08);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Hiệu ứng particles xung quanh trái tim */
        .heart-particles {
            position: absolute;
            inset: -50px;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: radial-gradient(circle, #ff6b8a, #ff4d6d);
            border-radius: 50%;
            opacity: 0;
            animation: particleFloat 4s ease-in-out infinite;
        }

        .particle:nth-child(1) {
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .particle:nth-child(2) {
            top: 30%;
            right: 15%;
            animation-delay: 0.5s;
        }

        .particle:nth-child(3) {
            bottom: 40%;
            left: 20%;
            animation-delay: 1s;
        }

        .particle:nth-child(4) {
            bottom: 20%;
            right: 10%;
            animation-delay: 1.5s;
        }

        .particle:nth-child(5) {
            top: 60%;
            left: 5%;
            animation-delay: 2s;
        }

        .particle:nth-child(6) {
            top: 10%;
            right: 25%;
            animation-delay: 2.5s;
        }

        .particle:nth-child(7) {
            bottom: 60%;
            right: 30%;
            animation-delay: 3s;
        }

        .particle:nth-child(8) {
            top: 50%;
            left: 80%;
            animation-delay: 3.5s;
        }

        @keyframes particleFloat {

            0%,
            100% {
                opacity: 0;
                transform: translateY(0) scale(0.5);
            }

            20% {
                opacity: 1;
                transform: translateY(-20px) scale(1);
            }

            80% {
                opacity: 1;
                transform: translateY(-40px) scale(0.8);
            }
        }

        /* Nhãn thông điệp */
        .message {
            margin-top: 6px;
            font-weight: 700;
            font-size: clamp(24px, 5vw, 38px);
            color: #ff4d88;
            letter-spacing: .4px;
            text-align: center;
            z-index: 1;
            animation: messageGlow 2s ease-in-out infinite;
            text-shadow: 0 0 20px rgba(194, 24, 91, 0.3);
        }

        @keyframes messageGlow {

            0%,
            100% {
                transform: translateY(0);
                text-shadow: 0 0 20px rgba(194, 24, 91, 0.3);
            }

            50% {
                transform: translateY(-6px);
                text-shadow: 0 0 30px rgba(194, 24, 91, 0.5);
            }
        }

        /* Nút Skip */
        .skip {
            position: fixed;
            right: 14px;
            top: 14px;
            z-index: 20;
            padding: 8px 12px;
            border-radius: 999px;
            border: 1px solid #ffd1de;
            background: #fff;
            color: #c2185b;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0, 0, 0, .05);
            cursor: pointer;
            transition: transform .1s ease, background .2s ease;
        }

        .skip:hover {
            background: #fff5f8;
        }

        .skip:active {
            transform: scale(.98);
        }

        @media (max-width:480px) {
            .wrap::after {
                width: 280px;
                height: 280px;
            }
        }

        /* ===== Mưa trái tim phủ full màn hình ===== */
        .heart-rain {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 8;
            /* trên nền, dưới nút Skip (z-index 20) */
        }

        .heart-rain .drop {
            position: absolute;
            top: -40px;
            left: 0;
            will-change: transform, opacity;
            opacity: 0.9;
            animation: fall var(--dur, 4s) linear forwards;
            transform: translate3d(0, -40px, 0) rotate(var(--rotStart, 0deg));
            filter: drop-shadow(0 4px 8px rgba(255, 77, 109, 0.35));
        }

        @keyframes fall {
            0% {
                opacity: 0.95;
                transform: translate3d(0, -40px, 0) rotate(var(--rotStart, 0deg));
            }

            60% {
                opacity: 0.95;
            }

            100% {
                opacity: 0;
                transform: translate3d(var(--drift, 0px), 120vh, 0) rotate(var(--rotEnd, 360deg));
            }
        }
    </style>
</head>

<body>

    <!-- Skip loading -->
    <button class="skip" aria-label="Bỏ qua loading và xem trái tim">Skip</button>

    <!-- LOADING -->
    <div class="loader" id="loader" aria-live="polite">
        <div class="loader-inner">
            <div class="title">Đang chuẩn bị điều bất ngờ cho Thúy Duy... 💞</div>

            <div class="progress-wrap" aria-label="Tiến trình">
                <!-- Icon trái tim chạy theo -->
                <div class="progress-heart" id="progressHeart" aria-hidden="true">
                    <svg viewBox="0 0 24 24" role="img" aria-label="Heart">
                        <path fill="currentColor"
                            d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5 2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.04L12,21.35Z" />
                    </svg>
                </div>

                <div class="progress-track">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="percent"><span id="percentNum">0</span>%</div>
            </div>
        </div>
    </div>
    <div class="heart-rain" aria-hidden="true"></div>

    <!-- SCENE -->
    <main class="scene" id="scene" hidden>
        <div class="wrap">
            <!-- Container trái tim với particles -->
            <div class="heart-container">
                <!-- Particles xung quanh -->
                <div class="heart-particles">
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                    <div class="particle"></div>
                </div>

                <!-- Trái tim 3D đẹp mới -->
                <svg class="heart-3d" viewBox="0 0 24 24" role="img" aria-label="Beautiful Beating Heart">
                    <defs>
                        <!-- Gradient chính với nhiều màu -->
                        <linearGradient id="heartMainGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#ff9bb5" />
                            <stop offset="25%" stop-color="#ff7a9a" />
                            <stop offset="50%" stop-color="#ff4d6d" />
                            <stop offset="75%" stop-color="#e43a57" />
                            <stop offset="100%" stop-color="#c2185b" />
                        </linearGradient>

                        <!-- Gradient cho highlight -->
                        <radialGradient id="heartHighlight" cx="30%" cy="25%" r="50%">
                            <stop offset="0%" stop-color="#ffffff" stop-opacity="0.8" />
                            <stop offset="40%" stop-color="#ffffff" stop-opacity="0.4" />
                            <stop offset="100%" stop-color="#ffffff" stop-opacity="0" />
                        </radialGradient>

                        <radialGradient id="innerGlow" cx="50%" cy="60%" r="60%">
                            <stop offset="0%" stop-color="#ffb6c1" stop-opacity="0.6" />
                            <stop offset="70%" stop-color="#ff4d6d" stop-opacity="0.3" />
                            <stop offset="100%" stop-color="#ff4d6d" stop-opacity="0" />
                        </radialGradient>

                        <!-- Inner glow */
                        <radialGradient id="innerGlow" cx="50%" cy="60%" r="60%">
                            <stop offset="0%" stop-color="rgba(255, 182, 193, 0.6)" />
                            <stop offset="70%" stop-color="rgba(255, 77, 109, 0.3)" />
                            <stop offset="100%" stop-color="rgba(255, 77, 109, 0)" />
                        </radialGradient>

                        <!-- Filter cho bóng và glow -->
                        <filter id="heartGlow" x="-50%" y="-50%" width="200%" height="200%">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur" />
                            <feMerge>
                                <feMergeNode in="coloredBlur" />
                                <feMergeNode in="SourceGraphic" />
                            </feMerge>
                        </filter>

                        <!-- 3D effect với bóng -->
                        <filter id="heart3d" x="-20%" y="-20%" width="140%" height="140%">
                            <feGaussianBlur in="SourceAlpha" stdDeviation="2" result="blur" />
                            <feOffset in="blur" dx="2" dy="4" result="offsetBlur" />
                            <feFlood flood-color="rgba(194, 24, 91, 0.4)" result="offsetColor" />
                            <feComposite in="offsetColor" in2="offsetBlur" operator="in" result="shadow" />
                            <feMerge>
                                <feMergeNode in="shadow" />
                                <feMergeNode in="SourceGraphic" />
                            </feMerge>
                        </filter>
                    </defs>

                    <!-- Bóng phía sau -->
                    <path
                        d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5 2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.04L12,21.35Z"
                        fill="rgba(194, 24, 91, 0.2)" transform="translate(1, 2)" />

                    <!-- Trái tim chính -->
                    <path
                        d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5 2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.04L12,21.35Z"
                        fill="url(#heartMainGrad)" filter="url(#heart3d)" />

                    <!-- Inner glow overlay -->
                    <path
                        d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5 2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.04L12,21.35Z"
                        fill="url(#innerGlow)" />

                    <!-- Highlight sáng bóng -->
                    <ellipse cx="9" cy="7.5" rx="3.5" ry="2.8" fill="url(#heartHighlight)" />
                    <ellipse cx="15" cy="7.5" rx="3.5" ry="2.8" fill="url(#heartHighlight)" />

                    <!-- Điểm sáng nhỏ -->
                    <circle cx="8.5" cy="6.8" r="1.2" fill="rgba(255, 255, 255, 0.9)" />
                    <circle cx="15.5" cy="6.8" r="1.2" fill="rgba(255, 255, 255, 0.9)" />
                </svg>
            </div>

            <div class="message">Tặng TDi ❤️</div>
        </div>
    </main>

    <script>
        (function () {
            const loader = document.getElementById('loader');
            const scene = document.getElementById('scene');
            const fill = document.getElementById('progressFill');
            const heart = document.getElementById('progressHeart');
            const percentNum = document.getElementById('percentNum');
            const skipBtn = document.querySelector('.skip');

            let p = 0;
            const step = 1;
            const tickMs = 50;

            function updateProgress(val) {
                fill.style.width = val + '%';
                percentNum.textContent = val.toString();

                const track = fill.parentElement;
                const trackRect = track.getBoundingClientRect();
                const heartSize = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--heart-size'));

                const moveDistance = trackRect.width * (val / 100);
                heart.style.transform = `translateX(calc(-50% + ${moveDistance}px))`;
            }

            function finish() {
                loader.classList.add('hidden');
                setTimeout(() => { loader.style.display = 'none'; }, 650);
                scene.hidden = false;
                requestAnimationFrame(() => scene.classList.add('show'));
                document.body.style.overflow = 'auto';
            }

            const timer = setInterval(() => {
                p += step;
                if (p > 100) p = 100;
                updateProgress(p);
                if (p === 100) {
                    clearInterval(timer);
                    setTimeout(finish, 300);
                }
            }, tickMs);

            skipBtn.addEventListener('click', () => {
                clearInterval(timer);
                p = 100;
                updateProgress(p);
                setTimeout(finish, 150);
            });

            window.addEventListener('load', () => updateProgress(0));
            window.addEventListener('resize', () => updateProgress(p));
        })();
    </script>
    <script>
        (function () {
            const loader = document.getElementById('loader');
            const scene = document.getElementById('scene');
            const fill = document.getElementById('progressFill');
            const heart = document.getElementById('progressHeart');
            const percentNum = document.getElementById('percentNum');
            const skipBtn = document.querySelector('.skip');

            let p = 0;
            const step = 1;
            const tickMs = 50;

            function updateProgress(val) {
                fill.style.width = val + '%';
                percentNum.textContent = val.toString();

                const track = fill.parentElement;
                const trackRect = track.getBoundingClientRect();
                const moveDistance = trackRect.width * (val / 100);
                heart.style.transform = `translateX(calc(-50% + ${moveDistance}px))`;
            }

            // === MƯA TIM DÀY ĐẶC PHỦ FULL MÀN HÌNH ===
            function startHeartRain() {
                const rain = document.querySelector('.heart-rain');
                if (!rain) return;

                // tuỳ chỉnh mật độ / hiệu năng
                const DENSITY_PER_TICK = 10;     // số tim tạo mỗi nhịp
                const TICK_MS = 120;             // chu kỳ bơm tim
                const MAX_DROPS = 350;           // giới hạn node trong DOM
                const EMOJIS = ['❤️']; // đa dạng

                function createDrop() {
                    const drop = document.createElement('div');
                    drop.className = 'drop';
                    drop.textContent = EMOJIS[(Math.random() * EMOJIS.length) | 0];

                    // random vị trí xuất phát (full width)
                    const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
                    drop.style.left = "0px";
                    // random kích cỡ & thời gian
                    const size = 14 + Math.random() * 24;        // 14px - 38px
                    const dur = 3.2 + Math.random() * 3.6;     // 3.2s - 6.8s
                    drop.style.fontSize = size + 'px';
                    drop.style.setProperty('--dur', dur + 's');

                    // drift ngang (âm hoặc dương) để bay chéo lung linh
                    const maxDrift = vw * (0.2 + Math.random() * 0.4); // 20% - 60% chiều ngang

                    const drift = (Math.random() < 0.5 ? -1 : 1) * maxDrift;
                    drop.style.setProperty('--drift', drift + 'px');

                    // xoay ngẫu nhiên
                    const rotStart = (Math.random() * 120 - 60).toFixed(1) + 'deg';
                    const rotEnd = (parseFloat(rotStart) + (Math.random() * 720 + 360)).toFixed(1) + 'deg';
                    drop.style.setProperty('--rotStart', rotStart);
                    drop.style.setProperty('--rotEnd', rotEnd);

                    // trễ khởi động nhẹ để tạo cảm giác layer dày
                    drop.style.animationDelay = (Math.random() * 0.6).toFixed(2) + 's';

                    rain.appendChild(drop);

                    drop.addEventListener('animationend', () => drop.remove());

                    // kiểm soát số lượng node để không nặng máy
                    if (rain.childElementCount > MAX_DROPS) {
                        // xoá bớt các node cũ nhất
                        const excess = rain.childElementCount - MAX_DROPS;
                        for (let i = 0; i < excess; i++) {
                            rain.firstElementChild?.remove();
                        }
                    }
                }

                // bơm nhiều tim mỗi tick để “full màn hình”
                setInterval(() => {
                    for (let i = 0; i < DENSITY_PER_TICK; i++) createDrop();
                }, TICK_MS);
            }

            function finish() {
                loader.classList.add('hidden');
                setTimeout(() => { loader.style.display = 'none'; }, 650);
                scene.hidden = false;
                requestAnimationFrame(() => scene.classList.add('show'));
                document.body.style.overflow = 'auto';

                // bắt đầu mưa tim dày đặc sau khi hiện scene
                startHeartRain();
            }

            const timer = setInterval(() => {
                p += step;
                if (p > 100) p = 100;
                updateProgress(p);
                if (p === 100) {
                    clearInterval(timer);
                    setTimeout(finish, 300);
                }
            }, tickMs);

            skipBtn.addEventListener('click', () => {
                clearInterval(timer);
                p = 100;
                updateProgress(p);
                setTimeout(finish, 150);
            });

            window.addEventListener('load', () => updateProgress(0));
            window.addEventListener('resize', () => updateProgress(p));
        })();
    </script>

    <script src="https://w.soundcloud.com/player/api.js"></script>

    <!-- Nhúng nhạc SoundCloud (ẩn) -->
    <iframe id="loveSong" width="0" height="0" style="display:none" allow="autoplay"
        src="https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/alozue-vermilion/please-tell-me-why-bao-thy-320-kbps&auto_play=false">
    </iframe>


    <script>
        (function () {
            const loader = document.getElementById('loader');
            const scene = document.getElementById('scene');
            const skipBtn = document.querySelector('.skip');
            const iframe = document.getElementById('loveSong');

            // Khởi tạo SoundCloud Widget API
            let widget = null;
            let widgetReady = false;

            function initWidget() {
                try {
                    widget = SC.Widget(iframe);
                    widget.bind(SC.Widget.Events.READY, function () {
                        widgetReady = true;
                        // tuỳ chọn: chỉnh âm lượng
                        widget.setVolume(100);
                    });
                } catch (e) {
                    // SC chưa load hoặc iframe chưa sẵn sàng
                }
            }

            initWidget();

            // Fallback: nếu widget chưa sẵn, thử lại sau khi DOM load
            window.addEventListener('load', () => {
                if (!widget) initWidget();
            });

            // Gọi phát nhạc (sau khi widget READY). Có retry nhẹ nếu gọi sớm.
            function tryPlaySong(retries = 8) {
                const playNow = () => {
                    try {
                        widget.seekTo(29000);
                        widget.play(); // có thể bị policy chặn nếu chưa có gesture
                    } catch (e) { }
                };

                if (widget && widgetReady) {
                    playNow();
                } else if (retries > 0) {
                    setTimeout(() => tryPlaySong(retries - 1), 250);
                }
            }

            // Fallback gesture: nếu bị chặn, lần chạm/bấm đầu tiên sẽ phát
            function attachGesturePlayOnce() {
                const handler = () => {
                    tryPlaySong();
                    window.removeEventListener('pointerdown', handler, { capture: true });
                    document.removeEventListener('keydown', handler, { capture: true });
                };
                window.addEventListener('pointerdown', handler, { capture: true, once: true });
                document.addEventListener('keydown', handler, { capture: true, once: true });
                // cũng gắn sẵn vào nút Skip
                skipBtn.addEventListener('click', handler, { once: true });
            }
            attachGesturePlayOnce();

            // ====== Heart rain (giữ nguyên) ======
            function startHeartRain() {
                const rain = document.querySelector('.heart-rain');
                if (!rain) return;

                const DENSITY_PER_TICK = 10, TICK_MS = 120, MAX_DROPS = 350;
                const EMOJIS = ['❤️'];

                function createDrop() {
                    const drop = document.createElement('div');
                    drop.className = 'drop';
                    drop.textContent = EMOJIS[(Math.random() * EMOJIS.length) | 0];
                    const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
                    drop.style.left = (Math.random() * vw) + 'px';
                    const size = 14 + Math.random() * 24;
                    const dur = 3.2 + Math.random() * 3.6;
                    drop.style.fontSize = size + 'px';
                    drop.style.setProperty('--dur', dur + 's');
                    const maxDrift = vw * (0.25 + Math.random() * 0.35);
                    const drift = (Math.random() < 0.5 ? -1 : 1) * maxDrift;
                    drop.style.setProperty('--drift', drift + 'px');
                    const rotStart = (Math.random() * 120 - 60).toFixed(1) + 'deg';
                    const rotEnd = (parseFloat(rotStart) + (Math.random() * 720 + 360)).toFixed(1) + 'deg';
                    drop.style.setProperty('--rotStart', rotStart);
                    drop.style.setProperty('--rotEnd', rotEnd);
                    drop.style.animationDelay = (Math.random() * 0.6).toFixed(2) + 's';
                    rain.appendChild(drop);
                    drop.addEventListener('animationend', () => drop.remove());
                    if (rain.childElementCount > MAX_DROPS) {
                        const excess = rain.childElementCount - MAX_DROPS;
                        for (let i = 0; i < excess; i++) rain.firstElementChild?.remove();
                    }
                }

                setInterval(() => {
                    for (let i = 0; i < DENSITY_PER_TICK; i++) createDrop();
                }, TICK_MS);
            }

            // ====== Điều khiển loader/progress (giữ nguyên logic, chỉ gom gọn) ======
            let p = 0;
            const step = 1, tickMs = 50;
            const fill = document.getElementById('progressFill');
            const heart = document.getElementById('progressHeart');
            const percentNum = document.getElementById('percentNum');

            function updateProgress(val) {
                fill.style.width = val + '%';
                percentNum.textContent = val.toString();
                const track = fill.parentElement;
                const trackRect = track.getBoundingClientRect();
                const moveDistance = trackRect.width * (val / 100);
                heart.style.transform = `translateX(calc(-50% + ${moveDistance}px))`;
            }

            function finish() {
                loader.classList.add('hidden');
                setTimeout(() => { loader.style.display = 'none'; }, 650);
                scene.hidden = false;
                requestAnimationFrame(() => scene.classList.add('show'));
                document.body.style.overflow = 'auto';

                // bắt đầu mưa tim & cố gắng phát nhạc
                startHeartRain();
                tryPlaySong();
            }

            const timer = setInterval(() => {
                p += step;
                if (p > 100) p = 100;
                updateProgress(p);
                if (p === 100) {
                    clearInterval(timer);
                    setTimeout(finish, 300);
                }
            }, tickMs);

            skipBtn.addEventListener('click', () => {
                clearInterval(timer);
                p = 100;
                updateProgress(p);
                setTimeout(finish, 150);
            });

            window.addEventListener('load', () => updateProgress(0));
            window.addEventListener('resize', () => updateProgress(p));
        })();
    </script>



</body>

</html>